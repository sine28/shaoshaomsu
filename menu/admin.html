<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f9fafb;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 420px;
        margin: auto;
        background-color: #f9fafb;
    }
    .header {
        background-color: white;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .header span h3 {
        font-size: 18px;
        font-weight: 500;
        color: #333;
        margin: 0;
    }
    .product-card, .progress-card, .location-card, .info-card {
        background-color: white;
        margin: 16px;
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .product-card .details { flex: 1; }
    .product-card .status {
        background-color: #dcfce7;
        color: #15803d;
        font-size: 12px;
        font-weight: 500;
        padding: 4px 8px;
        border-radius: 999px;
        display: inline-block;
    }
    .steps {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        font-size: 12px;
    }
    .circle {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 4px;
        color: white;
    }
    .circle.green { background-color: #22c55e; }
    .circle.gray { background-color: #e5e7eb; color: #9ca3af; }
    .line { flex: 1; height: 2px; }
    .line.green { background-color: #22c55e; }
    .line.gray { background-color: #e5e7eb; }
    .note-box {
        background-color: #fff7ed;
        padding: 8px;
        border-radius: 8px;
        margin-top: 8px;
    }
    .btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        font-weight: 500;
        font-size: 16px;
        cursor: pointer;
        border: none;
    }
    .btn-yellow { background-color: #fef3c7; color: #b45309; }
    .btn-green { background-color: #22c55e; color: white; }
    .btn-blue { background-color: #3b82f6; color: white; }
    .btn-cancel { background-color: #d97706; color: white; }
    .btn-outline { background-color: white; border: 2px solid #d1d5db; color: #374151; }
    .btn-logout { background-color: #ef4444; color: white; }
    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 14px;
    }
    .info-row span:first-child { color: #4b5563; display: flex; align-items: center; }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• */
    #adminLoginBox {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
        z-index: 9999;
    }
    #adminLoginBox .login-card {
        background: white; padding: 20px; border-radius: 12px;
        width: 300px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
</style>
</head>
<body>

<div class="container">
    <!-- Header -->
    <div class="header">
        <span><h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h3></span>
    </div>

    <!-- Product Card -->
    <div class="product-card" style="display: flex; align-items: flex-start;">
        <div id="productImage" style="width: 80px; height: 80px; background: #ddd; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
            <span>üì∑</span>
        </div>
        <div class="details">
            <h2 id="productName" style="margin: 0; font-size: 18px; font-weight: bold; color: #333;">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
            <p id="productPrice" style="margin: 4px 0; font-size: 16px; font-weight: 600; color: #4b5563;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ß‡∏±‡∏ô</p>
            <p id="productDates" style="margin: 4px 0; font-size: 12px; color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤</p>
            <span class="status" id="productStatus">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
        </div>
    </div>

    <!-- Progress Tracking -->
    <div class="progress-card">
        <div class="steps" id="progressSteps"></div>
    </div>

<!-- Panel ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• -->
<div id="adminPanel" style="display:none; margin:16px;">
    <label for="statusSelect"><strong>‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•)</strong></label>
    <select id="statusSelect" style="width:100%; padding:8px; margin-top:8px;">
        <option value="1">1 - ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏ä‡πà‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</option>
        <option value="2">2 - ‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
        <option value="3">3 - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
        <option value="4">4 - ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</option>
    </select>
    <button id="updateStatusBtn" class="btn btn-green" style="margin-top: 8px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
    <button onclick="logoutAdmin()" class="btn btn-logout" style="margin-top:12px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</button>
</div>


    <!-- Location Card -->
    <div class="location-card">
        <button class="btn btn-cancel" style="margin-top: 12px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤</button>
    </div>

    <!-- Info Card -->
    <div class="info-card">
        <div class="info-row"><span>üìÖ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤</span><span id="rentalDays">-</span></div>
        <div class="info-row"><span>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</span><span id="totalPrice" style="color: #16a34a;">-</span></div>
        <div class="info-row"><span>‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span><span id="timeLeft" style="color: #d97706;">-</span></div>
    </div>
</div>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• -->
<div id="adminLoginBox">
    <div class="login-card">
        <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h3>
        <input type="password" id="adminPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
        <p id="loginError" style="color: red; font-size: 14px; display: none; margin-top: 8px;">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        <button onclick="checkAdminPassword()" style="margin-top: 12px; width: 100%; padding: 8px; border: none; border-radius: 6px; background: #3b82f6; color: white; font-weight: bold; cursor: pointer;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
	<button style="margin-top: 12px; width: 100%; padding: 8px; border: none; border-radius: 6px; background: #3b82f6; color: white; font-weight: bold; cursor: pointer;"><a href="../index.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></button>
    </div>
</div>
<!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ä‡πà‡∏≤ -->
<div id="requestList" class="product-card" style="flex-direction: column;">
    <h3 style="margin-top:0;">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ä‡πà‡∏≤</h3>
    <div id="requestItems" style="display: flex; flex-direction: column; gap: 8px;"></div>
</div>

<script>
function getQueryParam(param) {
    return new URLSearchParams(window.location.search).get(param);
}

function getStatusText(status) {
    switch(status) {
        case 1: return "‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏ä‡πà‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô";
        case 2: return "‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå";
        case 3: return "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
        case 4: return "‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
        default: return "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞";
    }
}

function updateCountdown(endDateStr) {
    const endDate = new Date(endDateStr + "T23:59:59");
    const now = new Date();
    const diff = endDate - now;
    if (diff <= 0) return document.getElementById('timeLeft').textContent = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß";
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    document.getElementById('timeLeft').textContent = `${days} ‡∏ß‡∏±‡∏ô ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
}

function renderSteps(currentStep) {
    const stepsData = ["‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏ä‡πà‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô","‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå","‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô","‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"];
    const stepsContainer = document.getElementById("progressSteps");
    stepsContainer.innerHTML = "";
    stepsData.forEach((label, index) => {
        const stepNumber = index + 1;
        const isActive = stepNumber <= currentStep;
        const circle = document.createElement("div");
        circle.className = "circle " + (isActive ? "green" : "gray");
        circle.textContent = isActive ? "‚úî" : "‚óã";
        const text = document.createElement("span");
        text.textContent = label;
        const stepDiv = document.createElement("div");
        stepDiv.className = "step";
        stepDiv.appendChild(circle);
        stepDiv.appendChild(text);
        stepsContainer.appendChild(stepDiv);
        if (stepNumber < stepsData.length) {
            const line = document.createElement("div");
            line.className = "line " + (stepNumber < currentStep ? "green" : "gray");
            stepsContainer.appendChild(line);
        }
    });
}

function checkAdminPassword() {
    if (document.getElementById("adminPassword").value === "shao109") {
        localStorage.setItem("isAdmin", "true");
        showAdminPanel();
    } else {
        document.getElementById("loginError").style.display = "block";
    }
}

function logoutAdmin() {
    localStorage.removeItem("isAdmin");
    document.getElementById("adminPanel").style.display = "none";
    document.getElementById("adminLoginBox").style.display = "flex";
    document.getElementById("adminPassword").value = "";
}

function showAdminPanel() {
    document.getElementById("adminLoginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
}

function renderRequestList() {
    const requests = JSON.parse(localStorage.getItem('rentalRequests') || '[]');
    const container = document.getElementById("requestItems");
    container.innerHTML = "";

    if (requests.length === 0) {
        container.innerHTML = "<p style='color:#888;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ä‡πà‡∏≤</p>";
        return;
    }

    requests.forEach(req => {
        const item = document.createElement("div");
        item.style.display = "flex";
        item.style.alignItems = "center";
        item.style.padding = "8px";
        item.style.border = "1px solid #eee";
        item.style.borderRadius = "8px";
        item.style.cursor = "pointer";
        item.style.background = "#f9fafb";

        const name = document.createElement("div");
        name.style.flex = "1";
        name.textContent = req.deviceName || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠";

        const status = document.createElement("span");
        status.style.fontSize = "12px";
        status.style.color = "#555";
        status.textContent = getStatusText(req.statusStep || 1);

        item.appendChild(name);
        item.appendChild(status);

        item.onclick = () => {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå id
            window.location.href = `${window.location.pathname}?id=${req.id}`;
        };

        container.appendChild(item);
    });
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
renderRequestList();

const rentalId = getQueryParam('id');
const requests = JSON.parse(localStorage.getItem('rentalRequests') || '[]');
const itemIndex = requests.findIndex(r => String(r.id) === String(rentalId));
const item = requests[itemIndex];

if (item) {
    if (!item.statusStep) item.statusStep = 1;
    document.getElementById('productName').textContent = item.deviceName || '-';
    document.getElementById('productPrice').textContent = `${item.pricePerDay || 0} ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô`;
    document.getElementById('rentalDays').textContent = `${item.rentalDays || 0} ‡∏ß‡∏±‡∏ô`;
    document.getElementById('totalPrice').textContent = `${(item.pricePerDay || 0) * (item.rentalDays || 0)} ‡∏ö‡∏≤‡∏ó`;
    document.getElementById('productDates').textContent = `${item.startDate || '-'} - ${item.endDate || '-'}`;
    document.getElementById('productStatus').textContent = getStatusText(item.statusStep);

    updateCountdown(item.endDate || new Date());
    setInterval(() => updateCountdown(item.endDate || new Date()), 60000);
    renderSteps(item.statusStep);

    const statusSelect = document.getElementById("statusSelect");
    statusSelect.value = item.statusStep;

    // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    const updateBtn = document.getElementById("updateStatusBtn");
    updateBtn.onclick = () => {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô item ‡πÅ‡∏•‡∏∞ localStorage
        item.statusStep = parseInt(statusSelect.value);
        requests[itemIndex] = item;
        localStorage.setItem("rentalRequests", JSON.stringify(requests));

        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä UI
        renderSteps(item.statusStep);
        document.getElementById('productStatus').textContent = getStatusText(item.statusStep);
        alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
    };

    if (localStorage.getItem("isAdmin") === "true") {
        showAdminPanel();
    }
}
</script>
</body>
</html>
